<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="../../style/control.css">
    <link rel="stylesheet" href="http://maxiang.qiniudn.com/app/css/app.css?1408270014">
    <title>博客</title>
</head>
<body class="body">
    <div class="blog-item"><div id="preview-contents" class="note-content" style="padding-left: 35px; padding-right: 35px; padding-bottom: 161px;">
                        <div id="wmd-preview" class="preview-content"></div>
                    <div id="wmd-preview-section-1" class="wmd-preview-section preview-content">

</div><div id="wmd-preview-section-5" class="wmd-preview-section preview-content">

<h2 id="ueditor-1431-jsp-版本-重写图片上传">UEditor-[1.4.3.1 Jsp 版本] 重写图片上传</h2>

<p>记得以前版本的UEditor是可以配置上传路径的，不知为什么这个版本去掉了，没办法就修改了它的代码</p>

<p>ueditor/jsp/controller.jsp <br>
从这个文件中可以看出，它调用了ueditor jar包中的方法完成了文件的保存，所以只需要重写这个上传方法就可以了</p>

</div><div id="wmd-preview-section-6" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs">&lt;%@ page language=<span class="hljs-string">"java"</span> contentType=<span class="hljs-string">"text/html; charset=UTF-8"</span><br>    <span class="hljs-keyword">import</span>=<span class="hljs-string">"com.market.manage.controller.FileUploadController"</span><br>    pageEncoding=<span class="hljs-string">"UTF-8"</span>%&gt;<br>&lt;%@ page trimDirectiveWhitespaces=<span class="hljs-string">"true"</span> %&gt;<br>&lt;%<br>    request.setCharacterEncoding( <span class="hljs-string">"utf-8"</span> );<br>    response.setHeader(<span class="hljs-string">"Content-Type"</span> , <span class="hljs-string">"text/html"</span>);<br>    out.write( FileUploadController.uEditorUpload(request) );<br>%&gt;<br></code></pre>

</div><div id="wmd-preview-section-7" class="wmd-preview-section preview-content">

<pre class="prettyprint hljs-dark"><code class="language-java hljs"><span class="hljs-javadoc">/**<br>* 返回的结果是 看了ueditor的官方例子 然后在浏览器中获取的<br>*<span class="hljs-javadoctag"> @param</span> request<br>*<span class="hljs-javadoctag"> @return</span><br>*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">uEditorUpload</span><span class="hljs-params">(HttpServletRequest request)</span> </span>{<br>        String action = request.getParameter(<span class="hljs-string">"action"</span>);<br>        <span class="hljs-keyword">if</span> (!StringUtils.isEmpty(action) &amp;&amp; action.equalsIgnoreCase(<span class="hljs-string">"uploadimage"</span>)) {<br>            <span class="hljs-keyword">try</span> {<br>                DiskFileItemFactory factory = <span class="hljs-keyword">new</span> DiskFileItemFactory();<br>                ServletFileUpload upload = <span class="hljs-keyword">new</span> ServletFileUpload(factory);<br>                List&lt;FileItem&gt; fileItems = upload.parseRequest(request);<br>                SecureRandom random = <span class="hljs-keyword">new</span> SecureRandom();<br>                <span class="hljs-keyword">for</span> (FileItem item : fileItems) {<br>                    <span class="hljs-keyword">if</span> (item.getName() != <span class="hljs-keyword">null</span>) {<br>                        String fileName = item.getName();<br>                        String fileExt = fileName.substring(fileName.lastIndexOf(<span class="hljs-string">"."</span>) + <span class="hljs-number">1</span>).toUpperCase();<br>                        File destFile = File.createTempFile(<span class="hljs-string">"/tmp/"</span> + System.currentTimeMillis() + random.nextLong() + <span class="hljs-string">""</span>, <span class="hljs-string">"."</span> + fileExt);<br>                        item.write(destFile);<br>                        String fileURL = FastDFSUtil.iUpload(destFile, IGroup.IMAGE_NEW_1);<br>                        <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"original\":\""</span> + fileName + <span class="hljs-string">"\",\"name\":\""</span> + fileURL + <span class="hljs-string">"\",\"url\":\""</span> + <span class="hljs-string">"http://www.lagou.com"</span> + <span class="hljs-string">"/"</span> + fileURL + <span class="hljs-string">"\",\"size\":\""</span> + item.getSize() + <span class="hljs-string">"\",\"type\":\""</span> + fileExt + <span class="hljs-string">"\",\"state\":\"SUCCESS\"}"</span>;<br>                    }<br>                }<br>            } <span class="hljs-keyword">catch</span> (IOException e) {<br>                e.printStackTrace();<br>            } <span class="hljs-keyword">catch</span> (FileUploadException e) {<br>                e.printStackTrace();<br>            } <span class="hljs-keyword">catch</span> (Exception e) {<br>                e.printStackTrace();<br>            }<br>        }<br>        <span class="hljs-comment">//页面渲染时ueditor会检查上传组件是否配置好</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">"{\"imageActionName\":\"uploadimage\",\"imageFieldName\":\"upfile\",\"imageMaxSize\":2048000,\"imageAllowFiles\":[\".png\",\".jpg\",\".jpeg\",\".gif\",\".bmp\"],\"imageCompressEnable\":true,\"imageCompressBorder\":1600,\"imageInsertAlign\":\"none\",\"imageUrlPrefix\":\"\",\"imagePathFormat\":\"\\/server\\/ueditor\\/upload\\/image\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"scrawlActionName\":\"uploadscrawl\",\"scrawlFieldName\":\"upfile\",\"scrawlPathFormat\":\"\\/server\\/ueditor\\/upload\\/image\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"scrawlMaxSize\":2048000,\"scrawlUrlPrefix\":\"\",\"scrawlInsertAlign\":\"none\",\"snapscreenActionName\":\"uploadimage\",\"snapscreenPathFormat\":\"\\/server\\/ueditor\\/upload\\/image\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"snapscreenUrlPrefix\":\"\",\"snapscreenInsertAlign\":\"none\",\"catcherLocalDomain\":[\"127.0.0.1\",\"localhost\",\"img.baidu.com\"],\"catcherActionName\":\"catchimage\",\"catcherFieldName\":\"source\",\"catcherPathFormat\":\"\\/server\\/ueditor\\/upload\\/image\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"catcherUrlPrefix\":\"\",\"catcherMaxSize\":2048000,\"catcherAllowFiles\":[\".png\",\".jpg\",\".jpeg\",\".gif\",\".bmp\"],\"videoActionName\":\"uploadvideo\",\"videoFieldName\":\"upfile\",\"videoPathFormat\":\"\\/server\\/ueditor\\/upload\\/video\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"videoUrlPrefix\":\"\",\"videoMaxSize\":102400000,\"videoAllowFiles\":[\".flv\",\".swf\",\".mkv\",\".avi\",\".rm\",\".rmvb\",\".mpeg\",\".mpg\",\".ogg\",\".ogv\",\".mov\",\".wmv\",\".mp4\",\".webm\",\".mp3\",\".wav\",\".mid\"],\"fileActionName\":\"uploadfile\",\"fileFieldName\":\"upfile\",\"filePathFormat\":\"\\/server\\/ueditor\\/upload\\/file\\/{yyyy}{mm}{dd}\\/{time}{rand:6}\",\"fileUrlPrefix\":\"\",\"fileMaxSize\":51200000,\"fileAllowFiles\":[\".png\",\".jpg\",\".jpeg\",\".gif\",\".bmp\",\".flv\",\".swf\",\".mkv\",\".avi\",\".rm\",\".rmvb\",\".mpeg\",\".mpg\",\".ogg\",\".ogv\",\".mov\",\".wmv\",\".mp4\",\".webm\",\".mp3\",\".wav\",\".mid\",\".rar\",\".zip\",\".tar\",\".gz\",\".7z\",\".bz2\",\".cab\",\".iso\",\".doc\",\".docx\",\".xls\",\".xlsx\",\".ppt\",\".pptx\",\".pdf\",\".txt\",\".md\",\".xml\"],\"imageManagerActionName\":\"listimage\",\"imageManagerListPath\":\"\\/server\\/ueditor\\/upload\\/image\\/\",\"imageManagerListSize\":20,\"imageManagerUrlPrefix\":\"\",\"imageManagerInsertAlign\":\"none\",\"imageManagerAllowFiles\":[\".png\",\".jpg\",\".jpeg\",\".gif\",\".bmp\"],\"fileManagerActionName\":\"listfile\",\"fileManagerListPath\":\"\\/server\\/ueditor\\/upload\\/file\\/\",\"fileManagerUrlPrefix\":\"\",\"fileManagerListSize\":20,\"fileManagerAllowFiles\":[\".png\",\".jpg\",\".jpeg\",\".gif\",\".bmp\",\".flv\",\".swf\",\".mkv\",\".avi\",\".rm\",\".rmvb\",\".mpeg\",\".mpg\",\".ogg\",\".ogv\",\".mov\",\".wmv\",\".mp4\",\".webm\",\".mp3\",\".wav\",\".mid\",\".rar\",\".zip\",\".tar\",\".gz\",\".7z\",\".bz2\",\".cab\",\".iso\",\".doc\",\".docx\",\".xls\",\".xlsx\",\".ppt\",\".pptx\",\".pdf\",\".txt\",\".md\",\".xml\"]}"</span>;<br>    }<br></code></pre></div><div id="wmd-preview-section-footnotes" class="preview-content"></div></div>        <!-- UY BEGIN -->
        <div id="uyan_frame" style="margin-top: 50px;"></div>
        <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1957046"></script>
        <!-- UY END -->
    </div>
</body>
</html>